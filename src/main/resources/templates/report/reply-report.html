<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
    <title>Report Detail</title>
    <style>

        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            overflow-y: hidden;
            display: flex;
            align-items: flex-start;

        }

        .report-detail {
            padding: 20px;
            width: 500px;
            margin-top: 0px;
            box-sizing: border-box; /* 패딩 포함 너비 계산 */
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;

        }

        .details, .content {
            margin-bottom: 20px;
        }

        .details div {
            display: block;
            margin-bottom: 5px;
        }

        .report-title, .report-content {
            margin-bottom: 10px;
        }

        .delete-report {
            text-align: right;
            cursor: pointer;
            color: red;
            text-decoration: underline;
        }

        .report-button-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
    </style>


</head>
<body>

<div class="report-detail">
    <div class="header-top">
        <h2>댓글 신고</h2>
        <button class="btn btn-danger square-button" onclick="closeWindow()">X</button>
    </div>


    <form onsubmit="createReplyReportLog(); return false;">

        <!--신고 관련정보-->
        <div class="details">
            <div>
                <span class="badge bg-secondary text-white m-1">신&nbsp; 고&nbsp; 자</span>
                <span id="nickname" th:text="${nickname}"></span>
                /
                <span id="userName" th:text="${username}"></span>
            </div>

            <div>
                <span class="badge bg-secondary text-white m-1">신고 시간</span>
                <th:block th:text="${#dates.format(#dates.createNow(), 'yyyy-MM-dd HH:mm:ss')}">[신고시간]</th:block>
            </div>
            <div>
                <span class="badge bg-secondary text-white m-1">댓글 내용</span>
                <th:block th:text="${replyReport.replyContent}">[신고시간]</th:block>
            </div>
        </div>

        <!--신고버튼-->
        <div class="report-button-container">
            <button id="submitBtn" class="btn ml-2 btn-sm"
                    style="background-color: #67cafe; color:white">전송
            </button>
        </div>


        <!--신고 제목, 내용-->
        <div class="report-title">
            <label for="reportTitle" class="form-label">신고 제목</label>
            <input name="reportTitle" type="text" id="reportTitle" class="form-control">
        </div>

        <div class="report-content">
            <label for="reportContent" class="form-label">신고 내용</label>
            <textarea name="reportContent" id="reportContent" class="form-control" rows="4"></textarea>
        </div>


    </form>
</div>

<script>


    function createReplyReportLog() {

        const userId = document.getElementById("userName").textContent.trim();
        const reportTitle = document.getElementById("reportTitle").value;
        const reportContent = document.getElementById("reportContent").value;


        // 입력값 검증
        if (!reportTitle) {
            alert("신고 제목을 입력하세요.");
            return;
        }
        if (!reportContent) {
            alert("신고 내용을 입력하세요.");
            return;
        }

        // 사용자가 취소를 클릭한 경우 종료
        const isConfirmed = confirm("정말로 신고하시겠습니까?");
        if (!isConfirmed) {
            return;
        }



        // reportLogDTO생성
        const reportLogDTO = {
            userId: userId,
            replyNo: Number(`[[${replyReport.replyNo}]]`),
            reportTitle: reportTitle,
            reportContent: reportContent
        };

        axios.post('/report/reportLog', reportLogDTO)
            .then(function (response) {
                console.log("서버 응답:", response.data);
                closeWindow();
            })
            .catch(function (error) {
                console.error("에러 발생:", error);
            });


    }


    function closeWindow() {
        window.close();
    }

</script>


</body>
</html>
